function filtered(e){return e.substr(1).split("|").reduce(function(e,r){var n=r.split(":"),t=n.shift(),i=n.join(":")||"";return i&&(i=", "+i),"filters."+t+"("+e+i+")"})}function rethrow(e,r,n,t){var i=r.split("\n"),a=Math.max(t-3,0),s=Math.min(i.length,t+3),o=i.slice(a,s).map(function(e,r){var n=r+a+1;return(n==t?" >> ":"    ")+n+"| "+e}).join("\n");throw e.path=n,e.message=(n||"ejs")+":"+t+"\n"+o+"\n\n"+e.message,e}function resolveInclude(e,r){var n=join(dirname(r),e),t=extname(e);return t||(n+=".ejs"),n}var utils=require("./utils"),path=require("path"),dirname=path.dirname,extname=path.extname,join=path.join,fs=require("fs"),read=fs.readFileSync,filters=exports.filters=require("./filters"),cache={};exports.clearCache=function(){cache={}};var parse=exports.parse=function(e,r){var r=r||{},n=r.open||exports.open||"<%",t=r.close||exports.close||"%>",i=r.filename,a=r.compileDebug!==!1,s="";s+="var buf = [];",!1!==r._with&&(s+="\nwith (locals || {}) { (function(){ "),s+="\n buf.push('";for(var o=1,l=!1,c=0,u=e.length;u>c;++c){var f=e[c];if(e.slice(c,n.length+c)==n){c+=n.length;var p,h,m=(a?"__stack.lineno=":"")+o;switch(e[c]){case"=":p="', escape(("+m+", ",h=")), '",++c;break;case"-":p="', ("+m+", ",h="), '",++c;break;default:p="');"+m+";",h="; buf.push('"}var d=e.indexOf(t,c);if(0>d)throw new Error('Could not find matching close tag "'+t+'".');var x=e.substring(c,d),g=c,v=null,w=0;if("-"==x[x.length-1]&&(x=x.substring(0,x.length-2),l=!0),0==x.trim().indexOf("include")){var _=x.trim().slice(7).trim();if(!i)throw new Error("filename option is required for includes");var b=resolveInclude(_,i);v=read(b,"utf8"),v=exports.parse(v,{filename:b,_with:!1,open:n,close:t,compileDebug:a}),s+="' + (function(){"+v+"})() + '",x=""}for(;~(w=x.indexOf("\n",w));)w++,o++;":"==x.substr(0,1)&&(x=filtered(x)),x&&(x.lastIndexOf("//")>x.lastIndexOf("\n")&&(x+="\n"),s+=p,s+=x,s+=h),c+=d-g+t.length-1}else"\\"==f?s+="\\\\":"'"==f?s+="\\'":"\r"==f||("\n"==f?l?l=!1:(s+="\\n",o++):s+=f)}return s+=!1!==r._with?"'); })();\n} \nreturn buf.join('');":"');\nreturn buf.join('');"},compile=exports.compile=function(e,r){r=r||{};var n=r.escape||utils.escape,t=JSON.stringify(e),i=r.compileDebug!==!1,a=r.client,s=r.filename?JSON.stringify(r.filename):"undefined";e=i?["var __stack = { lineno: 1, input: "+t+", filename: "+s+" };",rethrow.toString(),"try {",exports.parse(e,r),"} catch (err) {","  rethrow(err, __stack.input, __stack.filename, __stack.lineno);","}"].join("\n"):exports.parse(e,r),r.debug&&console.log(e),a&&(e="escape = escape || "+n.toString()+";\n"+e);try{var o=new Function("locals, filters, escape, rethrow",e)}catch(l){throw"SyntaxError"==l.name&&(l.message+=r.filename?" in "+s:" while compiling ejs"),l}return a?o:function(e){return o.call(this,e,filters,n,rethrow)}};exports.render=function(e,r){var n,r=r||{};if(r.cache){if(!r.filename)throw new Error('"cache" option requires "filename".');n=cache[r.filename]||(cache[r.filename]=compile(e,r))}else n=compile(e,r);return r.__proto__=r.locals,n.call(r.scope,r)},exports.renderFile=function(e,r,n){var t=e+":string";"function"==typeof r&&(n=r,r={}),r.filename=e;var i;try{i=r.cache?cache[t]||(cache[t]=read(e,"utf8")):read(e,"utf8")}catch(a){return void n(a)}n(null,exports.render(i,r))},exports.__express=exports.renderFile,require.extensions?require.extensions[".ejs"]=function(e,r){r=r||e.filename;var n={filename:r,client:!0},t=fs.readFileSync(r).toString(),i=compile(t,n);e._compile("module.exports = "+i.toString()+";",r)}:require.registerExtension&&require.registerExtension(".ejs",function(e){return compile(e,{})});